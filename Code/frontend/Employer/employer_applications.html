<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer Applications</title>
</head>
<body>
    <h2>Employer Applications</h2>
    <div id="applicationsList">
    </div>
    <button onclick="goBack()">Go Back</button>

    <script>
        window.onload = async () => {
            try {
                const jobOffers = await fetchJobOffers();
                displayJobOffers(jobOffers);
            } catch (error) {
                console.error('Error fetching job offers:', error);
            }
        };

        async function fetchJobOffers() {
            // Fetch job offers made by the employer from the backend
            const response = await fetch('/Employer/JobOffer/joboffers');
            const jobOffers = await response.json();
            return jobOffers;
        }

        async function fetchApplications(jobOfferId) {
            const response = await fetch(`/Employer/JobOffer/${jobOfferId}/applications`);
            const applications = await response.json();
            return applications;
        }

        async function displayJobOffers(jobOffers) {
            const applicationsListDiv = document.getElementById('applicationsList');
            if (jobOffers.length === 0) {
                applicationsListDiv.innerHTML = '<p>No job offers found.</p>';
            } else {
                let html = '';
                for (const jobOffer of jobOffers) {
                    html += `<h3>Job Offer ID: ${jobOffer.JobOfferID}</h3>`;
                    html += `<p><strong>Title:</strong> ${jobOffer.Title}</p>`;
                    html += `<p><strong>Description:</strong> ${jobOffer.Description}</p>`;
                    html += '<h4>Applications:</h4>';
                    const applications = await fetchApplications(jobOffer.JobOfferID);
                    if (applications.length === 0) {
                        html += '<p>No applications found for this job offer.</p>';
                    } else {
                        html += '<ul>';
                        applications.forEach(application => {
                            html += `<li><strong>Candidate ID:</strong> ${application.CandidateID} - <strong>Description:</strong> ${application.Description} - <strong>Status:</strong> ${application.Status} - <strong>Date Applied:</strong> ${application.DateApplied}</li>`;
                        });
                        html += '</ul>';
                    }
                }
                applicationsListDiv.innerHTML = html;
            }
        }

        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html>
